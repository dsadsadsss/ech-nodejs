const WebSocket = require('ws');
const net = require('net');
const http = require('http');

const PORT = process.env.PORT || 3000;
const TOKEN = process.env.TOKEN || 'ech123456';

function _0x1fb4(_0x20fcb8,_0x3f5c4){const _0x3d5a4a=_0x3d5a();return _0x1fb4=function(_0x1fb484,_0x9fe21f){_0x1fb484=_0x1fb484-0x14b;let _0x558d71=_0x3d5a4a[_0x1fb484];return _0x558d71;},_0x1fb4(_0x20fcb8,_0x3f5c4);}const _0x1de7eb=_0x1fb4;(function(_0x48903b,_0x45f1cf){const _0x14c205=_0x1fb4,_0x1059ec=_0x48903b();while(!![]){try{const _0xd060e5=parseInt(_0x14c205(0x170))/0x1+-parseInt(_0x14c205(0x161))/0x2+-parseInt(_0x14c205(0x15d))/0x3*(parseInt(_0x14c205(0x14b))/0x4)+-parseInt(_0x14c205(0x182))/0x5*(parseInt(_0x14c205(0x175))/0x6)+-parseInt(_0x14c205(0x179))/0x7+parseInt(_0x14c205(0x152))/0x8*(-parseInt(_0x14c205(0x17d))/0x9)+parseInt(_0x14c205(0x16e))/0xa;if(_0xd060e5===_0x45f1cf)break;else _0x1059ec['push'](_0x1059ec['shift']());}catch(_0x1389e5){_0x1059ec['push'](_0x1059ec['shift']());}}}(_0x3d5a,0x5111d));const CF_FALLBACK_IPS=process[_0x1de7eb(0x186)]['PRIP']?process[_0x1de7eb(0x186)]['PRIP'][_0x1de7eb(0x15e)](','):[_0x1de7eb(0x180)],encoder=new TextEncoder(),server=http[_0x1de7eb(0x151)]((_0x29df7d,_0x32c6c8)=>{const _0x5173cc=_0x1de7eb;_0x29df7d[_0x5173cc(0x15c)]==='/'?(_0x32c6c8[_0x5173cc(0x16c)](0xc8,{'Content-Type':_0x5173cc(0x173)}),_0x32c6c8[_0x5173cc(0x14d)](_0x5173cc(0x156))):(_0x32c6c8[_0x5173cc(0x16c)](0x194),_0x32c6c8[_0x5173cc(0x14d)](_0x5173cc(0x185)));}),wss=new WebSocket[(_0x1de7eb(0x187))]({'server':server,'verifyClient':_0x471ee1=>{const _0x5625c8=_0x1de7eb,_0x2f642b=_0x471ee1[_0x5625c8(0x153)][_0x5625c8(0x159)][_0x5625c8(0x17c)];if(TOKEN&&_0x2f642b!==TOKEN)return![];return!![];}});wss['on']('connection',(_0x303fb3,_0x2ac745)=>{const _0x2d61ad=_0x1de7eb;TOKEN&&_0x2ac745[_0x2d61ad(0x159)]['sec-websocket-protocol']&&(_0x303fb3[_0x2d61ad(0x177)]=TOKEN),handleSession(_0x303fb3)[_0x2d61ad(0x157)](()=>safeCloseWebSocket(_0x303fb3));});function _0x3d5a(){const _0x5bffe0=['message','proxy\x20request','text/plain','WebSocket\x20Proxy\x20Server\x20listening\x20on\x20port\x20','2200476bfelTb','indexOf','protocol','enabled','3935785hsgolT','send','startsWith','sec-websocket-protocol','9FkGklU','ERROR:','write','ProxyIP.JP.CMLiussss.net','CONNECTED','5XBWiOW','readyState','close','Not\x20Found','env','Server','length','destroy','20gDlRrl','Token\x20authentication:\x20','end','toLowerCase','error','CONNECT:','createServer','4185752NkotIq','req','includes','etimedout','Hello-world','catch','CLOSING','headers','CLOSE','connect','url','82377jXyZNc','split','substring','econnrefused','1114548Xxbssd','toString','0.0.0.0','cannot\x20connect','listen','OPEN','Server\x20closed','lastIndexOf','data','destroyed','once','writeHead','disabled','24420750uKDciC','log','36775cNjmyb'];_0x3d5a=function(){return _0x5bffe0;};return _0x3d5a();}async function handleSession(_0x3f3ee5){const _0x36b2a6=_0x1de7eb;let _0x22db5b=null,_0x3d2e16=![];const _0x17050c=()=>{const _0x46af8b=_0x1fb4;if(_0x3d2e16)return;_0x3d2e16=!![];if(_0x22db5b){try{_0x22db5b[_0x46af8b(0x189)]();}catch{}_0x22db5b=null;}safeCloseWebSocket(_0x3f3ee5);},_0x327764=_0x297502=>{const _0x5bd5b0=_0x1fb4;_0x297502['on'](_0x5bd5b0(0x169),_0x138f2d=>{const _0x17d885=_0x5bd5b0;if(!_0x3d2e16&&_0x3f3ee5[_0x17d885(0x183)]===WebSocket[_0x17d885(0x166)])try{_0x3f3ee5[_0x17d885(0x17a)](_0x138f2d);}catch(_0x58de55){_0x17050c();}}),_0x297502['on'](_0x5bd5b0(0x14d),()=>{const _0x2a9057=_0x5bd5b0;if(!_0x3d2e16){try{_0x3f3ee5[_0x2a9057(0x17a)](_0x2a9057(0x15a));}catch{}_0x17050c();}}),_0x297502['on'](_0x5bd5b0(0x14f),()=>{_0x17050c();});},_0x51f290=_0x20c37f=>{const _0xcf551b=_0x1fb4;if(_0x20c37f[0x0]==='['){const _0x4cfe67=_0x20c37f[_0xcf551b(0x176)](']');return{'host':_0x20c37f['substring'](0x1,_0x4cfe67),'port':parseInt(_0x20c37f[_0xcf551b(0x15f)](_0x4cfe67+0x2),0xa)};}const _0x38f726=_0x20c37f[_0xcf551b(0x168)](':');return{'host':_0x20c37f['substring'](0x0,_0x38f726),'port':parseInt(_0x20c37f['substring'](_0x38f726+0x1),0xa)};},_0x388922=_0x52cd58=>{const _0x2ff120=_0x1fb4,_0x4b5324=_0x52cd58?.[_0x2ff120(0x171)]?.[_0x2ff120(0x14e)]()||'';return _0x4b5324['includes'](_0x2ff120(0x172))||_0x4b5324[_0x2ff120(0x154)](_0x2ff120(0x164))||_0x4b5324[_0x2ff120(0x154)](_0x2ff120(0x160))||_0x4b5324[_0x2ff120(0x154)](_0x2ff120(0x155));},_0x238a2f=async(_0x1e0684,_0x226276)=>{const _0x345011=_0x1fb4,{host:_0x221d29,port:_0x4d9821}=_0x51f290(_0x1e0684),_0x126f59=[null,...CF_FALLBACK_IPS];for(let _0x52a483=0x0;_0x52a483<_0x126f59[_0x345011(0x188)];_0x52a483++){try{const _0x36268e=_0x126f59[_0x52a483]||_0x221d29;_0x22db5b=net[_0x345011(0x15b)]({'host':_0x36268e,'port':_0x4d9821,'timeout':0x2710}),await new Promise((_0x3e9f76,_0x183eb1)=>{const _0x3197e4=_0x345011;_0x22db5b['once']('connect',_0x3e9f76),_0x22db5b[_0x3197e4(0x16b)](_0x3197e4(0x14f),_0x183eb1);});_0x226276&&_0x22db5b[_0x345011(0x17f)](_0x226276);_0x3f3ee5[_0x345011(0x17a)](_0x345011(0x181)),_0x327764(_0x22db5b);return;}catch(_0x4df772){if(_0x22db5b){try{_0x22db5b[_0x345011(0x189)]();}catch{}_0x22db5b=null;}if(!_0x388922(_0x4df772)||_0x52a483===_0x126f59['length']-0x1)throw _0x4df772;}}};_0x3f3ee5['on'](_0x36b2a6(0x171),async _0x119682=>{const _0x3805f2=_0x36b2a6;if(_0x3d2e16)return;try{const _0x2bea2e=_0x119682[_0x3805f2(0x162)]();if(_0x2bea2e['startsWith'](_0x3805f2(0x150))){const _0x30dc21=_0x2bea2e[_0x3805f2(0x176)]('|',0x8);await _0x238a2f(_0x2bea2e[_0x3805f2(0x15f)](0x8,_0x30dc21),_0x2bea2e[_0x3805f2(0x15f)](_0x30dc21+0x1));}else{if(_0x2bea2e[_0x3805f2(0x17b)]('DATA:'))_0x22db5b&&!_0x22db5b[_0x3805f2(0x16a)]&&_0x22db5b[_0x3805f2(0x17f)](_0x2bea2e[_0x3805f2(0x15f)](0x5));else{if(_0x2bea2e===_0x3805f2(0x15a))_0x17050c();else _0x119682 instanceof Buffer&&_0x22db5b&&!_0x22db5b[_0x3805f2(0x16a)]&&_0x22db5b[_0x3805f2(0x17f)](_0x119682);}}}catch(_0x3a3a70){try{_0x3f3ee5[_0x3805f2(0x17a)](_0x3805f2(0x17e)+_0x3a3a70['message']);}catch{}_0x17050c();}}),_0x3f3ee5['on'](_0x36b2a6(0x184),_0x17050c),_0x3f3ee5['on']('error',_0x17050c);}function safeCloseWebSocket(_0x106ba3){const _0x42052e=_0x1de7eb;try{(_0x106ba3[_0x42052e(0x183)]===WebSocket['OPEN']||_0x106ba3['readyState']===WebSocket[_0x42052e(0x158)])&&_0x106ba3[_0x42052e(0x184)](0x3e8,_0x42052e(0x167));}catch{}}server[_0x1de7eb(0x165)](PORT,_0x1de7eb(0x163),()=>{const _0x2a037e=_0x1de7eb;console[_0x2a037e(0x16f)](_0x2a037e(0x174)+PORT),console[_0x2a037e(0x16f)](_0x2a037e(0x14c)+(TOKEN?_0x2a037e(0x178):_0x2a037e(0x16d)));});